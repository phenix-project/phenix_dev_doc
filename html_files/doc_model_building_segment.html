{% extends "phenix/header.html" %}

{% load static %}

{% block content %}

<div class="container">

<div class="row">


<div class="col-sm-9">
<!-- DO NOT EDIT ANYTHING ABOVE!!!! -->
<!----------------------- EDIT START ---------------------------->

<h2><center>Replacing a segment of a model</center></h2>

<p class="lead mt-4">Replace a part of a model by swapping in a segment from a similar model.</p>

<p>Let’s replace a part of a model by finding a similar model in the PDB and swapping in the segment from that model. This procedure is very similar to fitting a loop, but we are going to use a segment right from the PDB to fill in our loop instead of trying to build it from scratch.</p>

<p>Let’s get set up again. We are going to start from the beginning and get our map and model in a slightly different way than we have so far. We’ll load the  DataManager and read in a model from the phenix_regression directory:</p>

<pre class="codeDL"><code>from iotbx.data_manager import DataManager    # Load in the DataManager
dm = DataManager()             # Initialize the DataManager and call it dm
dm.set_overwrite(True)         # Overwrite files with the same name
</code></pre>

<pre class="codeDL"><code>model = dm.get_model("structure_search_target.pdb")    # read in a model
</code></pre>

<pre class="codeDL"><code>mmm = dm.get_map_model_manager(  # getting a map_model_manager
    model_file = "structure_search_target.pdb",)
</code></pre>

<p>The map_model_manager  mmm knows how to generate a model-based map from a model. Let’s create a map at a resolution of 3 A and specify that this is a cryo-EM map:</p>

<pre class="codeDL"><code>mmm.generate_map(d_min=3)        #   generate map to resolution of 3 A
</code></pre>

<pre class="codeDL"><code>mmm.set_experiment_type('cryo_em')   # this is a cryo-EM map
</code></pre>

<p>Now we are ready to get a model_building object and to specify that we want to use the ‘structure_search’ method to replace a segment. Just to see how it works, we’ll turn on debugging (prints more output too) and set the thoroughness of the run to ‘quick’:</p>

<pre class="codeDL"><code>build = mmm.model_building()          # get a model-building object
build.set_defaults(                   # set some defaults
     thoroughness='quick',            #  quick run
     debug=True,)                     # turn on debugging output
</code></pre>

<p>We can save and write out the starting model before we modify it:</p>

<pre class="codeDL"><code>model_before_replace = build.model().deep_copy()   #  save model
dm.write_model_file(build.model(), 'model_before_replace.pdb')# starting model
</code></pre>

<p>We can now run the segment replacement:</p>

<pre class="codeDL"><code>replace_segment_model=build.replace_segment(    # replace a segment
     chain_id="A",                       #  chain to work on
     last_resno_before_replace=21,       # just before replace
     first_resno_after_replace=35,       # just after replace
     refine_cycles=1,)                   # cycles of refinement
</code></pre>

<p>And we can insert the new segment, get a new map_model_manager, and write out the results:</p>

<pre class="codeDL"><code>build.insert_fitted_loop()         # inserts loops or segments
mam=build.as_map_model_manager()   # get a map_model_manager to write out with
mam.write_model('model_with_replacement.pdb') #  the model
mam.write_map('map_for_replacement.ccp4')  #   the map
</code></pre>

<p>Have a look at the starting model (model_before_replace.pdb), the model with a replacement segment (model_with_replacement.pdb), and the map (map_for_replacement.ccp4).</p>

<!----------------------- EDIT END ---------------------------->
<!-- DO NOT EDIT ANYTHING BELOW!!!! -->
</div> <!-- end col-sm-9 -->

<!-- automatic table of contents
     located in the sidebar; will move to the top on a small screen -->
<div class="col-sm-3">
  <nav id="toc" data-toggle="toc"></nav>
</div> <!-- end col-sm-3 -->

</div> <!-- end row -->

</div> <!-- end container -->

{% endblock %}
